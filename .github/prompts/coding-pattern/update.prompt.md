---
name: coding-pattern.update
description: '既存のコーディング規約 instructions ファイルを最新のコードベースに基づいて更新'
argument-hint: 'fileName=更新対象のファイル名（拡張子なし）'
tools: ['read/problems', 'read/readFile', 'edit/editFiles', 'search/fileSearch', 'context7/*', 'todo']
---

# コーディング規約更新

## 目的
既存のコーディング規約 instructions ファイルを最新のコードベースに基づいて更新し、現在の実装パターンとの一貫性を保つ

## 入力
- fileName:例: `python` - 更新対象のコーディング規約ファイル名（拡張子なし）

## 入力検証
ファイル名が欠落している場合:
1. `.github/instructions/` ディレクトリ内の `.instructions.md` ファイル一覧を表示
2. ユーザーに更新対象ファイル名（拡張子なし）の入力を求める
3. ファイル名が提供されるまで実行を停止

## ワークフロー

### フェーズ 0: todo リスト作成
下記のタスクを #tool:todo で管理し実行する

1. 既存コーディング規約ファイルの読み込み
2. 対象ファイルの収集と分析
3. パターン比較と差分抽出
4. コーディング規約ファイル更新

### フェーズ 1: 既存コーディング規約ファイルの読み込み
1. #tool:read/readFile で `.github/instructions/${input:fileName}.coding-pattern.instructions.md` を読み込む
2. ファイルが存在しない場合、ユーザーに報告して停止
3. frontmatter から `applyTo` パターンを抽出

### フェーズ 2: 対象ファイルの収集と分析
1. #tool:search/fileSearch で抽出した `applyTo` パターンに一致するファイルを検索
2. 一致するファイルが 0 件の場合、ユーザーに報告
  - `applyTo` パターンが古い可能性を指摘
  - パターンの更新を提案
3. #tool:read/readFile で各ファイルの内容を読み取る（並列実行可能）
  - サンプリング戦略: ファイル数が多い場合は代表的なファイル（10〜15件程度）に絞る

### フェーズ 3: パターン比較と差分抽出
現在のコードベースと既存の規約を比較し、以下を特定:

#### 新規パターン
- 既存規約に記載されていない新しい実装パターン
- 新しい命名規則やアーキテクチャパターン
- 新しいライブラリやツールの使用方法

#### 廃止パターン
- 既存規約に記載されているが、現在使用されていないパターン
- 非推奨となったアプローチ

#### 変更パターン
- 既存規約と異なる実装が標準になっているパターン
- ベストプラクティスの進化

#### 継続パターン
- 既存規約と一致し、引き続き使用されているパターン

### フェーズ 4: コーディング規約ファイル更新
1. フェーズ 3 で特定した差分に基づき、規約ファイルを更新
2. #tool:edit/editFiles を使用して既存ファイルを更新
3. 更新内容のサマリーをユーザーに報告

## 更新方針

### frontmatter の更新
- `applyTo` パターンが現在のディレクトリ構造と一致しない場合、更新を提案
- `description` が規約の内容を正確に反映しているか確認し、必要に応じて更新

### セクション構成の最適化
- 新規パターンが既存セクションに適合しない場合、新しいセクションを追加
- 廃止パターンのセクションは削除または「非推奨」として明示
- セクションの順序を重要度や使用頻度に基づいて再編成

### コード例の更新
- 古いコード例を最新の実装パターンで置き換え
- 新しいパターンには実際のコードベースから抽出した例を追加
- 良い例と悪い例を明確に区別

### 一貫性の保持
- instructions.instructions.md の規約に準拠
- 既存の文体とフォーマットを維持
- 他のコーディング規約ファイルとの一貫性を考慮

## 出力構造

更新ファイル: `.github/instructions/${input:fileName}.coding-pattern.instructions.md`

更新後、以下の情報をユーザーに報告:

```markdown
## 更新サマリー

### 新規追加
- [新規追加されたセクションやパターン]

### 更新
- [更新されたセクションやパターン]

### 削除
- [削除または非推奨となったセクションやパターン]

### 変更なし
- [変更が不要だったセクション]

### 推奨アクション
- [規約に準拠するための推奨される次のステップ]
```

## 要件
- 実際のコードベースとの一貫性を最優先
- 抽出したパターンは具体的なコード例を含める
- 変更理由を明確に説明
- 既存の規約の意図を尊重しつつ、現実に即した更新を行う
- instructions.instructions.md の規約に準拠した frontmatter を維持

## エラーハンドリング

### 規約ファイルが見つからない場合
1. `.github/instructions/` ディレクトリ内の利用可能なファイルをリストアップ
2. ユーザーに正しいファイル名の入力を求めて停止

### `applyTo` パターンに一致するファイルがない場合
1. パターンが古くなっている可能性を報告
2. 現在のディレクトリ構造を確認し、新しいパターンを提案
3. ユーザーに `applyTo` パターンの更新可否を確認

### パターンの差分が検出されない場合
1. 規約が最新であることを報告
2. 最後の更新日時と分析したファイル数を表示
3. 強制更新の必要性をユーザーに確認

### コードベースとの大きな乖離がある場合
1. 主要な乖離点を列挙
2. 段階的な更新アプローチを提案
3. 優先順位の高い更新から着手することを推奨