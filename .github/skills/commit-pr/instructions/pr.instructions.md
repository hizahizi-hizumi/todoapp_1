---
description: 'Git のチーム開発フローにおける PR 粒度・レビュー容易性・履歴品質のルールとベストプラクティス'
applyTo: '**/*'
---

# 目的とスコープ
このドキュメントは、チーム開発における **PR（Pull Request / Merge Request）の粒度**、**レビュー容易性**、**マージまでのリードタイム短縮**、**安全なロールバック**を実現するためのルールとベストプラクティスを定義します

# PR 粒度（コア原則）
- PR は「1 つの目的（single purpose）」に集中させる
  - 例: 1 つの機能追加、1 つのバグ修正、1 つのパフォーマンス改善、1 つのリファクタ
- 無関係な変更は PR に混ぜない（別 PR に分割する）
- PR は小さく保つ（レビューで理解できる単位に分割する）
  - 目安: レビューが辛いサイズになったら分割を検討し、理由なく巨大化させない
- 可能な範囲で、各 PR は「単体でマージ可能・デプロイ可能」な状態に寄せる
  - 例: 途中状態が必要な場合は、機能フラグや段階導入を使って安全に分割する

# PR の分割方針（設計）
- 「機械的変更（整形・リネーム・移動）」は単独 PR に分離する
- 「リファクタ（挙動不変）」と「挙動変更（機能追加・修正）」は原則分ける
  - ただし、挙動変更を安全にするために必要な最小限のリファクタは例外
- 依存関係更新・CI 変更・開発環境変更は、アプリ挙動の変更と混ぜない（原則別 PR）
- 大きな機能は、次のいずれかの戦略で「小さい PR の列」にする
  - 垂直スライス（小さく使える単位で機能を完成させる）
  - 段階導入（機能フラグ、互換レイヤ、移行を段階化）
  - スタック（依存関係を明示した複数 PR を順に積む）

# PR のレビュー容易性（内容・構成）
- タイトルは短く具体的にする（「何が変わるか」が 1 行で分かる）
- PULL_REPUEST_TEMPLATE が存在する場合、そのフォーマットに従う
- PULL_REPUEST_TEMPLATE に従ったうえで、PR 本文には以下を含める
  - 変更の要約（What）
  - 変更理由 / 背景（Why）
  - 動作確認方法（How to test）
- リスクがある場合は明示する（影響範囲、後方互換、パフォーマンス、セキュリティ）
- UI 変更がある場合はスクリーンショットや動画を添付する（可能な範囲で）
- 破壊的変更（breaking change）や移行が必要な変更は明示し、移行手順を記載する
- ドキュメント更新が必要なら同 PR に含めるか、別 PR にするかを方針化する

# レビュー・マージの品質
- CI が通る状態を維持する（既知の失敗があるなら理由と対応方針を明記する）
- 差分が大きい場合は、なぜ大きいのか、分割できない理由、レビューの推奨順序を本文に書く
- 「後で直す」前提の未完成状態を main に入れない（入れるなら必ず安全策を用意する）

# 禁止事項
- 無関係な変更を「ついで」で混ぜた PR を作成しない
- フォーマッタ全体適用のような大規模機械的変更を、挙動変更 PR に混ぜない
- PR を巨大化させてレビューを諦めさせない（分割、段階導入、機能フラグを優先する）
